ПОЛНОЕ ТЕХНИЧЕСКОЕ ЗАДАНИЕ НА РАЗРАБОТКУ ПЛАТФОРМЫ JAZYLРАЗДЕЛ 1: КОНЦЕПЦИЯ И ПОЗИЦИОНИРОВАНИЕ ПРОЕКТАПлатформа Jazyl представляет собой комплексную цифровую экосистему, созданную для революционной трансформации индустрии красоты и персонального ухода в странах Центральной Азии с последующей экспансией на международные рынки. Фундаментальное отличие проекта от существующих агрегаторов услуг заключается в предоставлении каждому бизнесу полноценного white-label решения, которое включает автоматически генерируемый веб-сайт с интегрированной системой онлайн-записи, полнофункциональную CRM-систему и инструменты управления всеми операционными процессами салона.Стратегическая цель платформы состоит в создании устойчивой экосистемы, где малый и средний бизнес сферы красоты получает доступ к технологиям уровня крупных международных сетей, но без необходимости инвестировать в разработку собственных решений. Платформа должна стать незаменимым инструментом для владельцев салонов, предоставляя им не просто программное обеспечение, а комплексное решение для построения и развития цифрового присутствия их бренда.Целевая аудитория платформы строго сегментирована по восьми основным категориям бизнеса. Категория парикмахерских услуг охватывает как классические женские салоны, так и современные барбершопы, предоставляющие услуги стрижки, укладки, окрашивания и ухода за волосами. Ногтевой сервис включает все виды маникюра и педикюра, от базового до сложного дизайна и наращивания. Категория ухода за телом объединяет массажные кабинеты и СПА-центры, предлагающие различные виды массажа, обертывания и релаксационные процедуры. Услуги макияжа включают как повседневный, так и профессиональный макияж для особых случаев. Удаление волос представлено лазерной и восковой эпиляцией. Косметология охватывает широкий спектр от эстетических процедур до аппаратной косметологии. Тату и пирсинг составляют отдельную категорию с учетом специфики данных услуг. Брови и ресницы объединяют услуги коррекции, окрашивания, ламинирования бровей, а также наращивания и ламинирования ресниц.Принцип категоризации является архитектурным фундаментом всей платформы и влияет на каждый аспект функционирования системы. Категория определяет позиционирование салона в каталоге, логику конкуренции в системе продвижения, структуру аналитических отчетов и механизмы рекомендаций клиентам. Смена категории после регистрации не предусмотрена, что обеспечивает целостность данных и честную конкуренцию в рамках каждого сегмента.Архитектура платформы построена по принципу единого бэкенд-ядра, которое обслуживает множественные клиентские интерфейсы через RESTful API. Веб-панель управления для администраторов платформы предоставляет инструменты глобального управления системой. Веб-панель для владельцев салонов, менеджеров и мастеров реализована как единое приложение с динамически изменяющимся интерфейсом в зависимости от роли пользователя. Кроссплатформенные мобильные приложения для iOS и Android обеспечивают мастерам возможность работы в движении, а клиентам предоставляют удобный интерфейс для поиска салонов и управления записями. Автоматически генерируемые веб-сайты для каждого салона создаются на основе шаблонной системы с возможностью кастомизации и полностью интегрированы с системой онлайн-записи. Публичный каталог салонов с многоуровневой фильтрацией служит точкой входа для клиентов, ищущих услуги красоты.РАЗДЕЛ 2: АРХИТЕКТУРА МОДЕЛИ ДАННЫХ И СТРУКТУРА БАЗЫ ДАННЫХАрхитектура базы данных платформы спроектирована с учетом требований масштабируемости, производительности и целостности данных. Используется PostgreSQL версии 15 и выше как основная реляционная СУБД с поддержкой JSON-полей для хранения гибких структур данных, где это необходимо.Центральная таблица users хранит базовую информацию обо всех пользователях системы независимо от их роли. Структура включает первичный ключ id типа UUID для обеспечения глобальной уникальности и возможности распределенного генерирования идентификаторов. Поле email используется для аутентификации сотрудников салонов через OAuth Google и является уникальным с соответствующим индексом. Номер телефона phone хранится в международном формате E.164 и используется как основной идентификатор для клиентов. Поле phone_verified типа boolean указывает на статус верификации номера телефона. Поля first_name, last_name и middle_name хранят полное имя пользователя с поддержкой всех трех языков платформы. Поле role типа enum определяет роль пользователя и может принимать значения platform_admin, salon_owner, salon_manager, master, client. Поле google_id используется для связи с учетной записью Google при OAuth-аутентификации. Системные поля created_at и updated_at типа timestamp with time zone автоматически управляются через триггеры для отслеживания времени создания и последнего обновления записи. Поле is_active типа boolean управляет активностью учетной записи, а deleted_at реализует механизм мягкого удаления данных.Таблица salon_categories содержит справочник категорий бизнеса и является полностью предзаполненной при инициализации системы. Структура включает первичный ключ id, уникальный код категории code типа varchar для программного доступа, мультиязычные названия name_ru, name_kk, name_en для поддержки локализации, описания description_ru, description_kk, description_en, поле icon_url для хранения ссылки на иконку категории, порядок сортировки sort_order типа integer для управления отображением в интерфейсах, флаг активности is_active. Индексы создаются на поля code и is_active для оптимизации запросов фильтрации.Таблица salons представляет основную сущность бизнеса на платформе. Поле id является первичным ключом типа UUID. Внешний ключ owner_id ссылается на users.id и определяет владельца салона с ограничением on delete restrict для предотвращения случайного удаления. Внешний ключ category_id ссылается на salon_categories.id и устанавливается при создании салона без возможности последующего изменения. Поле business_name хранит юридическое название бизнеса, а display_name используется для отображения клиентам. Уникальное поле slug генерируется автоматически из display_name и используется для формирования поддомена вида slug.jazyl.tech с уникальным индексом. Поле description типа text содержит описание салона с поддержкой мультиязычности через отдельные поля description_ru, description_kk, description_en. Поле logo_url хранит ссылку на логотип салона, а cover_image_url на обложку для сайта и каталога. Контактная информация включает email, phone и website_url. JSON-поле social_links хранит структуру с социальными сетями вида instagram, facebook, whatsapp. Поле subscription_plan_id ссылается на таблицу subscription_plans и определяет текущий тарифный план. Временные метки subscription_start_date и subscription_end_date управляют активностью подписки. Поле is_active определяет активность салона в системе, а is_visible_in_catalog управляет видимостью в публичном каталоге. Поле advertising_budget типа decimal с точностью до двух знаков хранит текущий баланс рекламного бюджета. Поле auction_bid типа decimal содержит текущую ставку для участия в аукционе за топ-позиции в каталоге. Стандартные временные метки created_at, updated_at и deleted_at обеспечивают аудит изменений.Таблица salon_branches управляет филиалами салонов и позволяет вести несколько локаций под единым брендом. Первичный ключ id типа UUID, внешний ключ salon_id ссылается на salons.id с каскадным удалением on delete cascade. Поле branch_name содержит название филиала для внутреннего использования, а display_name для отображения клиентам. Полный адрес разбит на компоненты: country, city, street_address, building_number, postal_code для структурированного хранения и возможности точного геопоиска. Географические координаты latitude и longitude типа decimal с точностью до 8 знаков обеспечивают позиционирование на картах. Контактная информация филиала включает phone и email. JSON-поле working_hours хранит график работы в формате где ключами являются дни недели monday через sunday, а значениями объекты с полями is_working, open_time, close_time, breaks массивом объектов с from и to для обеденных перерывов. Поле is_main типа boolean обозначает главный филиал с уникальным частичным индексом на комбинацию salon_id и is_main где is_main равен true для обеспечения наличия только одного главного филиала у салона. Поля created_at, updated_at и is_active управляют жизненным циклом записи.Таблица services определяет услуги, предоставляемые салоном. Первичный ключ id типа UUID, внешний ключ salon_id с каскадным удалением. Мультиязычные названия service_name_ru, service_name_kk, service_name_en и описания description_ru, description_kk, description_en обеспечивают полную локализацию. Поле duration_minutes типа integer определяет стандартную длительность услуги в минутах. Ценовая политика реализована через поля base_price типа decimal как базовая стоимость, и JSON-поле price_tiers для хранения дифференцированных цен по категориям мастеров в формате массива объектов с полями master_tier, price, где master_tier принимает значения junior, middle, senior, expert. Поле category типа varchar позволяет группировать услуги внутри салона для удобства навигации. Поле image_url содержит ссылку на изображение услуги для отображения в каталоге и на сайте. Поле is_active управляет доступностью услуги для новых записей без удаления исторических данных. Поле sort_order определяет порядок отображения в списках. Временные метки created_at и updated_at отслеживают изменения.Таблица masters управляет связью пользователей-мастеров с салонами и содержит специфичную для роли мастера информацию. Первичный ключ id типа UUID, внешний ключ user_id ссылается на users.id с ограничением on delete cascade. Внешний ключ salon_id определяет принадлежность к салону. Поле tier типа enum определяет категорию мастера из значений junior, middle, senior, expert и влияет на стоимость услуг при использовании дифференцированного ценообразования. Мультиязычные поля bio_ru, bio_kk, bio_en хранят биографию мастера для отображения на сайте. Поле specialization типа text содержит специализацию мастера. JSON-поле portfolio_images хранит массив URL изображений работ мастера. Поле experience_years типа integer указывает опыт работы в годах. Поле rating типа decimal с точностью до двух знаков вычисляется автоматически на основе отзывов клиентов. Поле total_reviews типа integer хранит количество отзывов для оптимизации запросов рейтинга. JSON-поле permissions управляет расширенными правами мастера и содержит флаги can_manage_own_schedule, can_edit_profile, can_edit_service_prices. Поле is_active определяет активность мастера в салоне, позволяя временно деактивировать без удаления данных. Поле invited_at типа timestamp хранит время отправки приглашения, а joined_at время принятия приглашения и активации учетной записи. Поля created_at и updated_at для аудита.Таблица master_branches реализует связь многие-ко-многим между мастерами и филиалами, позволяя одному мастеру работать в нескольких локациях салона. Составной первичный ключ из master_id и branch_id обеспечивает уникальность комбинации. Внешние ключи с каскадным удалением связывают с таблицами masters и salon_branches. Временные метки created_at фиксируют время назначения мастера в филиал.Таблица master_services определяет какие услуги оказывает конкретный мастер и позволяет устанавливать индивидуальное ценообразование. Составной первичный ключ из master_id и service_id. Внешние ключи ссылаются на masters и services с каскадным удалением. Поле custom_price типа decimal позволяет переопределить базовую стоимость услуги для данного мастера, если оставлено null используется цена из service согласно tier мастера. Мультиязычные поля custom_description_ru, custom_description_kk, custom_description_en позволяют мастеру добавить персонализированное описание услуги. Поле is_active управляет доступностью услуги у данного мастера для новых записей. Временные метки created_at и updated_at отслеживают изменения.Таблица master_schedules управляет рабочим расписанием мастеров. Первичный ключ id типа UUID, внешний ключ master_id с каскадным удалением. Внешний ключ branch_id определяет филиал для которого действует расписание. Поле day_of_week типа integer принимает значения от 1 до 7 где 1 это понедельник. Поле is_working типа boolean определяет работает ли мастер в этот день. Временные поля start_time и end_time типа time without time zone определяют начало и конец рабочего дня. JSON-поле breaks хранит массив объектов с перерывами в формате break_start, break_end времени перерыва и reason для причины перерыва. Уникальный индекс на комбинацию master_id, branch_id, day_of_week предотвращает дублирование расписания для одного дня.Таблица schedule_exceptions управляет исключениями из стандартного расписания для особых дат. Первичный ключ id типа UUID, внешний ключ master_id. Поле exception_date типа date определяет дату исключения. Поле exception_type типа enum принимает значения day_off, custom_hours, fully_booked. Поля custom_start_time и custom_end_time типа time используются при exception_type равном custom_hours. Поле reason типа text хранит причину исключения для внутреннего использования. Индекс на master_id и exception_date оптимизирует проверку исключений при генерации доступных слотов.Таблица bookings является центральной для системы онлайн-записи. Первичный ключ id типа UUID, внешний ключ client_id ссылается на users.id и определяет клиента сделавшего запись. Внешний ключ master_id определяет мастера. Внешний ключ service_id определяет заказанную услугу. Внешний ключ branch_id указывает филиал где будет проведена услуга. Поле booking_date типа date содержит дату записи. Поле start_time типа time содержит время начала. Поле end_time типа time вычисляется автоматически как start_time плюс service.duration_minutes. Поле final_price типа decimal хранит финальную стоимость услуги зафиксированную на момент создания записи для защиты от изменения цен. Поле status типа enum управляет жизненным циклом записи и принимает значения pending, confirmed, in_progress, completed, cancelled_by_client, cancelled_by_salon, no_show. Поле created_via типа enum фиксирует источник создания записи из значений website, mobile_app, catalog, manager. Поля notes_from_client и notes_for_master типа text содержат комментарии к записи. Поле reminded_at типа timestamp фиксирует время отправки напоминания клиенту. Поле completed_at фиксирует время отметки о выполнении услуги. Поле cancelled_at и cancellation_reason фиксируют отмену. Временные метки created_at и updated_at для аудита. Индексы создаются на client_id, master_id, branch_id, booking_date, status для оптимизации запросов списков записей и проверки занятости.Таблица reviews управляет отзывами клиентов. Первичный ключ id типа UUID, внешний ключ booking_id ссылается на bookings.id с ограничением on delete cascade и уникальным индексом обеспечивающим один отзыв на одну запись. Внешний ключ client_id ссылается на users.id. Внешний ключ salon_id определяет салон для которого оставлен отзыв. Внешний ключ master_id опционально определяет мастера если отзыв оставлен на конкретного специалиста. Поле rating типа integer с ограничением check от 1 до 5 содержит оценку. Поле review_text типа text содержит текст отзыва. JSON-поле review_photos хранит массив URL фотографий приложенных к отзыву. Поле is_verified типа boolean автоматически устанавливается в true так как отзывы доступны только после завершенных визитов. Поле is_visible управляет отображением отзыва в публичном доступе для возможности модерации. Поле salon_response типа text содержит ответ салона на отзыв если был оставлен. Поле responded_at фиксирует время ответа. Временные метки created_at и updated_at. Индексы на salon_id, master_id, is_visible для оптимизации запросов отображения отзывов.Таблица subscription_plans содержит предзаполненные тарифные планы платформы. Первичный ключ id типа UUID, уникальный код плана plan_code типа varchar для программного доступа. Мультиязычные названия plan_name_ru, plan_name_kk, plan_name_en и описания description_ru, description_kk, description_en. Поле monthly_price типа decimal содержит стоимость подписки в месяц. Поле currency типа varchar по умолчанию KZT для тенге. JSON-поле features хранит структуру с ограничениями и возможностями плана в формате max_masters, max_branches, max_monthly_bookings, has_custom_domain, has_advanced_analytics, has_api_access, priority_support. Поле is_active управляет доступностью плана для новых подписок. Поле sort_order определяет порядок отображения планов. Временные метки created_at и updated_at.Таблица payments отслеживает все финансовые транзакции в системе. Первичный ключ id типа UUID, внешний ключ salon_id определяет салон совершивший платеж. Поле payment_type типа enum определяет тип платежа из значений subscription, advertising_budget. Поле amount типа decimal содержит сумму платежа. Поле currency типа varchar. Поле payment_method типа enum содержит метод оплаты из значений card, bank_transfer, electronic_wallet. Поле payment_status типа enum управляет статусом из значений pending, completed, failed, refunded. Поле transaction_id типа varchar хранит идентификатор транзакции во внешней платежной системе. JSON-поле payment_metadata содержит дополнительную информацию о платеже. Временные метки created_at, completed_at для отслеживания проведения платежа.Таблица catalog_impressions отслеживает показы салонов в каталоге для аналитики и биллинга рекламной системы. Первичный ключ id типа UUID, внешний ключ salon_id. Поле impression_date типа date, поле impression_hour типа integer от 0 до 23 для почасовой агрегации. Поле position типа integer хранит позицию салона в выдаче на момент показа. Поле is_promoted типа boolean указывает был ли показ платным. Поле cost типа decimal содержит стоимость показа для платных позиций. Уникальный индекс на salon_id, impression_date, impression_hour, position предотвращает дублирование записей при агрегации.Таблица catalog_clicks отслеживает клики по салонам в каталоге. Первичный ключ id типа UUID, внешний ключ salon_id. Внешний ключ client_id опционально определяет авторизованного пользователя совершившего клик. Поле clicked_at типа timestamp with time zone. Поле is_promoted типа boolean. Поле cost типа decimal содержит стоимость клика для платных позиций. Поле session_id типа UUID группирует действия в рамках одной сессии пользователя. Индексы на salon_id, clicked_at для аналитических запросов.Таблица whatsapp_sessions управляет сессиями интеграции WhatsApp. Первичный ключ id типа UUID, поле session_id типа varchar хранит уникальный идентификатор сессии в WhatsApp Web JS. Поле qr_code типа text содержит данные QR-кода для инициализации сессии. Поле status типа enum принимает значения initializing, qr_ready, authenticated, disconnected, failed. Поле authenticated_at типа timestamp фиксирует успешную аутентификацию. Поле last_heartbeat типа timestamp обновляется при каждой проверке активности соединения. Поле connection_attempts типа integer считает попытки переподключения. Временные метки created_at и updated_at.Таблица whatsapp_messages логирует все отправленные сообщения WhatsApp. Первичный ключ id типа UUID, внешний ключ user_id определяет получателя сообщения. Поле phone_number типа varchar содержит номер получателя в международном формате. Поле message_type типа enum определяет тип сообщения из значений verification_code, booking_confirmation, booking_reminder, booking_cancellation, review_request. Поле message_body типа text содержит текст отправленного сообщения. Поле status типа enum отслеживает статус доставки из значений queued, sent, delivered, read, failed. Поле sent_at, delivered_at, read_at фиксируют временные метки изменения статуса. Поле error_message типа text содержит описание ошибки при неудачной доставке. Поле retry_count типа integer считает попытки повторной отправки. Временная метка created_at. Индексы на user_id, phone_number, status для мониторинга доставки.Таблица verification_codes управляет кодами верификации телефонных номеров. Первичный ключ id типа UUID, поле phone_number типа varchar с индексом. Поле code типа varchar хранит шестизначный код. Поле expires_at типа timestamp определяет время истечения кода. Поле is_used типа boolean предотвращает повторное использование. Поле verified_at фиксирует время успешной верификации. Поле attempts типа integer считает попытки ввода кода для защиты от брутфорса. Временная метка created_at. Индекс на phone_number и expires_at для очистки истекших кодов.Таблица audit_logs обеспечивает аудит критичных операций в системе. Первичный ключ id типа UUID, внешний ключ user_id определяет пользователя совершившего действие. Поле action_type типа varchar содержит код действия например user_login, booking_created, salon_settings_updated. Поле entity_type типа varchar определяет тип затронутой сущности. Поле entity_id типа UUID содержит идентификатор сущности. JSON-поле changes хранит детальную информацию об изменениях в формате old_values и new_values. Поле ip_address типа inet фиксирует IP адрес. Поле user_agent типа text содержит информацию о клиенте. Временная метка created_at. Партиционирование таблицы по полю created_at по месяцам для оптимизации хранения и запросов исторических данных.Таблица site_customizations хранит настройки кастомизации автоматически генерируемых сайтов салонов. Первичный ключ id типа UUID, внешний ключ salon_id с уникальным индексом обеспечивающим одну конфигурацию на салон. Поле template_name типа varchar определяет выбранный шаблон дизайна из доступных modern, classic, minimalist, luxury. JSON-поле color_scheme содержит палитру цветов в формате primary_color, secondary_color, accent_color, text_color, background_color. JSON-поле fonts содержит выбранные шрифты heading_font и body_font. JSON-поле hero_section настраивает главный экран сайта с полями title, subtitle, background_image_url, cta_button_text. JSON-поле sections управляет отображением и порядком секций сайта массивом объектов с section_type, is_visible, sort_order где section_type принимает значения about, services, masters, portfolio, reviews, contacts. Мультиязычные поля custom_text_ru, custom_text_kk, custom_text_en позволяют добавлять произвольный контент. Поле favicon_url содержит ссылку на иконку сайта. JSON-поле seo_settings содержит meta_title, meta_description, meta_keywords для каждого языка. Временные метки created_at и updated_at.Таблица notifications управляет системой уведомлений. Первичный ключ id типа UUID, внешний ключ user_id определяет получателя. Поле notification_type типа enum определяет тип из значений booking_created, booking_reminder, booking_cancelled, review_received, payment_successful, subscription_expiring. Поле title типа varchar содержит заголовок уведомления. Поле message типа text содержит текст уведомления. JSON-поле data хранит дополнительные данные связанные с уведомлением для возможности навигации к соответствующему объекту. Поле is_read типа boolean управляет статусом прочтения. Поле read_at фиксирует время прочтения. Поле sent_via типа enum массивом определяет каналы доставки whatsapp, email, push, in_app. Временная метка created_at. Индексы на user_id, is_read для запросов непрочитанных уведомлений.РАЗДЕЛ 3: ПОЛНАЯ СПЕЦИФИКАЦИЯ API ЭНДПОИНТОВAPI платформы реализовано на базе FastAPI и следует принципам RESTful архитектуры. Все эндпоинты доступны по базовому URL api.jazyl.tech с обязательным использованием HTTPS протокола. Версионирование API реализуется через префикс пути /api/v1/. Аутентификация для эндпоинтов требующих авторизации осуществляется через JWT токены передаваемые в заголовке Authorization со значением Bearer токен. Токены имеют время жизни 24 часа для access token и 30 дней для refresh token. Все ответы API возвращаются в формате JSON с установленным заголовком Content-Type application/json. Коды статусов HTTP используются согласно стандарту: 200 для успешных запросов, 201 для успешного создания ресурса, 204 для успешного удаления, 400 для ошибок валидации, 401 для неавторизованных запросов, 403 для запрещенных операций, 404 для отсутствующих ресурсов, 409 для конфликтов при создании дублирующих ресурсов, 422 для ошибок обработки данных, 429 для превышения лимитов запросов, 500 для внутренних ошибок сервера.Группа эндпоинтов аутентификации и управления пользователями обеспечивает регистрацию и вход в систему. Эндпоинт POST /api/v1/auth/request-code принимает JSON объект с полем phone в формате E.164 например +77012345678 и опциональным полем language для выбора языка сообщения из значений ru, kk, en по умолчанию ru. Система генерирует шестизначный код верификации сохраняет его в таблицу verification_codes с временем жизни 5 минут и отправляет через WhatsApp. Возвращает 200 с телом code_sent true, expires_in 300. При повторном запросе для того же номера в течение 60 секунд возвращается 429 с сообщением об ожидании. При сбое отправки WhatsApp возвращается 500 с детальной ошибкой.Эндпоинт POST /api/v1/auth/verify-code принимает JSON с полями phone и code. Система проверяет наличие активного кода в базе, совпадение значения, срок действия и количество попыток не превышающее 3. При успешной верификации создается или находится существующий пользователь с ролью client, генерируются access и refresh токены JWT с полезной нагрузкой содержащей user_id, role, phone. Возвращается 200 с телом access_token, refresh_token, user объектом с полями id, phone, first_name, last_name, role. При неверном коде возвращается 400 с сообщением invalid_code и оставшимся количеством попыток attempts_left. При истечении кода 400 с expired_code. При превышении попыток 429 с too_many_attempts и необходимостью запросить новый код.Эндпоинт POST /api/v1/auth/google инициирует OAuth аутентификацию через Google для сотрудников салонов. Принимает JSON с полем id_token полученным от Google Sign-In. Система валидирует токен через Google API, извлекает email и google_id, проверяет существование пользователя с данным email или google_id. Если пользователь существует и его роль не client генерируются токены и возвращаются аналогично verify-code. Если пользователь не найден и это первый вход возвращается 404 с сообщением user_not_found и необходимостью регистрации через приглашение салона. Эндпоинт не создает новых пользователей автономно, так как сотрудники салонов должны быть приглашены владельцем.Эндпоинт POST /api/v1/auth/refresh принимает JSON с полем refresh_token. Система валидирует токен, проверяет не истек ли срок действия, не был ли токен отозван через занесение в Redis blacklist при логауте. При успешной валидации генерируются новые access и refresh токены, старый refresh токен добавляется в blacklist с TTL равным оставшемуся времени жизни. Возвращается 200 с новыми токенами. При невалидном токене 401 с invalid_token.Эндпоинт POST /api/v1/auth/logout принимает текущий access_token через заголовок Authorization. Система извлекает refresh токен из запроса или из связи с access токеном в Redis, добавляет оба токена в blacklist. Возвращается 204 без тела. Все последующие запросы с этими токенами будут отклонены с 401.Группа эндпоинтов управления профилем пользователя требует аутентификации. Эндпоинт GET /api/v1/users/me возвращает полную информацию о текущем пользователе. Для роли client возвращается объект с полями id, phone, phone_verified, first_name, last_name, email, created_at, upcoming_bookings массивом предстоящих записей, past_bookings_count количеством завершенных визитов. Для ролей связанных с салоном дополнительно включаются salon_id, salon_name, branch_ids массивом филиалов для мастеров, permissions объектом с флагами доступных операций. Возвращается 200 с полным объектом пользователя.Эндпоинт PATCH /api/v1/users/me обновляет профиль пользователя. Принимает JSON с опциональными полями first_name, last_name, middle_name, email. Для клиентов возможно обновление только имени. Для сотрудников салонов можно обновить все поля. Валидация email проверяет формат и уникальность. Возвращается 200 с обновленным объектом пользователя. При конфликте email 409 с email_already_exists.Эндпоинт POST /api/v1/users/me/photo загружает фото профиля. Принимает multipart/form-data с файлом photo. Система валидирует формат файла jpg, jpeg, png, размер не более 5МБ, загружает в объектное хранилище или локальную файловую систему в зависимости от конфигурации, генерирует URL изображения. Возвращается 200 с полем photo_url. При ошибках валидации 400 с описанием проблемы.Группа эндпоинтов управления салонами доступна владельцам и менеджерам. Эндпоинт POST /api/v1/salons создает новый салон и доступен только после OAuth аутентификации пользователя без существующего салона или с правами на создание дополнительных салонов согласно тарифу. Принимает JSON с обязательными полями business_name, display_name, category_id выбором из существующих категорий, city, phone, email и опциональными description_ru, description_kk, description_en, website_url, social_links объектом. Система валидирует уникальность display_name для генерации slug, создает запись салона, автоматически создает главный филиал с данными из запроса, назначает владельца из текущего пользователя, создает запись подписки на trial план на 14 дней. Возвращается 201 с полным объектом салона включая id, slug, subscription объект с plan_name, expires_at. При дублировании имени 409 с slug_already_exists. При недоступной категории 400 с invalid_category_id.Эндпоинт GET /api/v1/salons/:salon_id возвращает полную информацию о салоне. Доступен владельцу, менеджерам и мастерам салона. Возвращает объект с полями id, business_name, display_name, slug, category с вложенным объектом id, name_ru, name_kk, name_en, description, logo_url, cover_image_url, contacts объектом с email, phone, website, social_links, subscription объектом с plan с вложенным названием и фичами, start_date, end_date, is_active, branches массивом филиалов с полной информацией, statistics объектом с total_masters, total_bookings_this_month, total_reviews, average_rating, is_visible_in_catalog, advertising объектом с budget, current_bid. Возвращается 200 с полным объектом. При отсутствии доступа 403.Эндпоинт PATCH /api/v1/salons/:salon_id обновляет информацию о салоне. Доступен только владельцу. Принимает JSON с опциональными полями display_name, description_ru, description_kk, description_en, phone, email, website_url, social_links. При изменении display_name проверяется уникальность и регенерируется slug. Возвращается 200 с обновленным объектом салона. При конфликте slug 409.Эндпоинт POST /api/v1/salons/:salon_id/logo загружает логотип салона. Принимает multipart/form-data с файлом logo. Валидация аналогична фото профиля с дополнительной проверкой рекомендуемых размеров 512x512 пикселей. Загружает файл и обновляет поле logo_url. Возвращается 200 с logo_url. При ошибках 400.Эндпоинт POST /api/v1/salons/:salon_id/cover загружает обложку для сайта и каталога. Принимает cover файл с рекомендованными размерами 1920x600 пикселей. Обновляет cover_image_url. Возвращается 200 с cover_image_url.Группа эндпоинтов управления филиалами салона. Эндпоинт GET /api/v1/salons/:salon_id/branches возвращает список всех филиалов салона. Доступен сотрудникам салона. Возвращает массив объектов филиалов с полями id, branch_name, display_name, address объектом с country, city, street_address, building_number, postal_code, coordinates объектом с latitude, longitude, contacts с phone, email, working_hours объектом с расписанием на каждый день недели, is_main, masters_count количеством мастеров привязанных к филиалу, is_active. Возвращается 200 с массивом филиалов.Эндпоинт POST /api/v1/salons/:salon_id/branches создает новый филиал. Доступен владельцу с проверкой лимита филиалов по тарифу. Принимает JSON с обязательными branch_name, display_name, city, street_address, building_number, phone и опциональными country по умолчанию Kazakhstan, postal_code, latitude, longitude для геопозиционирования, email, working_hours объектом. При отсутствии working_hours применяется стандартное расписание с понедельника по субботу с 09:00 до 20:00 и выходным воскресеньем. Возвращается 201 с созданным объектом филиала. При превышении лимита тарифа 403 с branch_limit_exceeded и предложением upgrade.Эндпоинт PATCH /api/v1/salons/:salon_id/branches/:branch_id обновляет филиал. Доступен владельцу и менеджерам. Принимает JSON с опциональными полями аналогично созданию. При изменении адреса рекомендуется обновить coordinates. Возвращается 200 с обновленным объектом филиала.Эндпоинт DELETE /api/v1/salons/:salon_id/branches/:branch_id удаляет филиал. Доступен только владельцу. Проверяет что филиал не является единственным у салона и не главным без переназначения флага is_main другому филиалу. Проверяет отсутствие предстоящих записей в данном филиале. При наличии записей возвращается 409 с has_upcoming_bookings и списком дат с активными записями. Мастера привязанные к филиалу отвязываются автоматически. Возвращается 204 при успехе.Группа эндпоинтов управления услугами салона. Эндпоинт GET /api/v1/salons/:salon_id/services возвращает список услуг. Доступен публично для отображения на сайте салона и в каталоге, а также сотрудникам для управления. Поддерживает параметры запроса category для фильтрации по внутренней категории, is_active по умолчанию true, master_id для получения услуг конкретного мастера. Возвращает массив объектов услуг с полями id, service_name_ru, service_name_kk, service_name_en, description по языку из заголовка Accept-Language, duration_minutes, base_price, price_tiers массивом объектов tier, price, category, image_url, is_active, masters_count количеством мастеров оказывающих услугу. Возвращается 200 с массивом услуг.Эндпоинт POST /api/v1/salons/:salon_id/services создает новую услугу. Доступен владельцу и менеджерам. Принимает JSON с обязательными service_name_ru, duration_minutes минимум 15, base_price больше 0 и опциональными service_name_kk, service_name_en, description_ru, description_kk, description_en, category строка для группировки, price_tiers массивом если используется дифференцированное ценообразование, image_url. Валидация проверяет что сумма услуг не превышает лимит тарифа для тарифов с ограничениями. Возвращается 201 с созданной услугой.Эндпоинт PATCH /api/v1/salons/:salon_id/services/:service_id обновляет услугу. Доступен владельцу и менеджерам. Принимает JSON с опциональными полями аналогично созданию. При изменении duration_minutes или цен система не затрагивает существующие записи сохраняя историческую точность. Возвращается 200 с обновленной услугой.Эндпоинт DELETE /api/v1/salons/:salon_id/services/:service_id удаляет услугу. Доступен владельцу. Фактически выполняет мягкое удаление устанавливая is_active в false. Услуга остается видимой в исторических записях. Возвращается 204.Группа эндпоинтов управления мастерами. Эндпоинт GET /api/v1/salons/:salon_id/masters возвращает список мастеров салона. Доступен сотрудникам для внутреннего использования и публично для отображения на сайте с параметром public true который скрывает приватные данные. Поддерживает параметры branch_id для фильтрации по филиалу, service_id для мастеров оказывающих конкретную услугу, is_active по умолчанию true. Возвращает массив объектов мастеров с полями id, user с вложенными first_name, last_name, middle_name, photo_url, tier строкой junior, middle, senior, expert, bio по языку, specialization, experience_years, rating, total_reviews, portfolio_images массивом URL, branches массивом объектов с id и display_name филиалов где работает мастер, services массивом услуг с id, service_name, custom_price если установлена, permissions объектом видимым только владельцу и менеджерам, is_active. Возвращается 200 с массивом мастеров.Эндпоинт POST /api/v1/salons/:salon_id/masters/invite отправляет приглашение новому мастеру. Доступен владельцу и менеджерам. Принимает JSON с обязательными email, first_name, last_name, tier, branch_ids массивом филиалов к которым привязывается мастер и опциональными middle_name, specialization, service_ids массивом услуг которые будет оказывать мастер. Валидация проверяет что email не зарегистрирован в системе как другая роль. Система создает пользователя с ролью master в неактивном состоянии, создает запись в таблице masters с привязкой к салону, отправляет email приглашение с уникальной ссылкой на активацию содержащей токен. Возвращается 201 с объектом invited_master содержащим id, email, invited_at.Эндпоинт POST /api/v1/masters/accept-invitation/:token активирует приглашение мастера. Публично доступен по токену из email приглашения. Принимает JSON с обязательным id_token от Google OAuth для завершения регистрации. Система валидирует токен приглашения, проверяет срок действия 7 дней, извлекает email из Google OAuth и сверяет с email приглашения. При совпадении активирует пользователя устанавливая is_active в true, сохраняет google_id, обновляет joined_at. Возвращается 200 с access и refresh токенами для немедленного входа. При истечении токена 400 с invitation_expired.Эндпоинт PATCH /api/v1/salons/:salon_id/masters/:master_id обновляет информацию о мастере. Доступен владельцу для изменения любых полей и самому мастеру для изменения полей разрешенных permissions.can_edit_profile. Принимает JSON с опциональными tier, specialization, bio_ru, bio_kk, bio_en, experience_years, branch_ids, service_ids, permissions объектом для владельца. При изменении tier пересчитываются цены услуг использующих price_tiers. Возвращается 200 с обновленным объектом мастера.Эндпоинт POST /api/v1/salons/:salon_id/masters/:master_id/portfolio добавляет изображения в портфолио мастера. Доступен владельцу и мастеру с permissions.can_edit_profile. Принимает multipart/form-data с массивом файлов images максимум 10 изображений за раз. Каждое изображение валидируется на формат и размер до 5МБ. Загруженные изображения добавляются к существующему массиву portfolio_images. Возвращается 200 с обновленным portfolio_images массивом URL.Эндпоинт DELETE /api/v1/salons/:salon_id/masters/:master_id/portfolio/:image_url удаляет изображение из портфолио. Принимает URL закодированный в path параметре. Удаляет из массива portfolio_images и из хранилища если используется локальное. Возвращается 204.Эндпоинт DELETE /api/v1/salons/:salon_id/masters/:master_id деактивирует мастера. Доступен только владельцу. Выполняет мягкое удаление устанавливая is_active в false. Проверяет отсутствие предстоящих записей у мастера. При наличии возвращается 409 с has_upcoming_bookings и требованием переназначить или отменить записи. Возвращается 204.Группа эндпоинтов управления расписанием мастеров. Эндпоинт GET /api/v1/masters/:master_id/schedule возвращает расписание мастера. Доступен мастеру, владельцу, менеджерам салона и публично для расчета доступных слотов. Поддерживает параметр branch_id для расписания в конкретном филиале. Возвращает объект с полями regular_schedule массивом из 7 элементов по дням недели с day_of_week, is_working, start_time, end_time, breaks массивом перерывов, exceptions массивом будущих исключений с exception_date, exception_type, custom_start_time, custom_end_time, reason. Возвращается 200 с объектом расписания.Эндпоинт PUT /api/v1/masters/:master_id/schedule обновляет базовое расписание мастера. Доступен владельцу, менеджерам и мастеру с permissions.can_manage_own_schedule. Принимает JSON с обязательным branch_id и regular_schedule массивом из 7 объектов с обязательными day_of_week, is_working и условно обязательными start_time, end_time если is_working true, опциональным breaks массивом. Валидация проверяет что start_time меньше end_time, перерывы находятся внутри рабочего времени, перерывы не пересекаются. Система полностью перезаписывает расписание для указанного филиала. Возвращается 200 с обновленным расписанием.Эндпоинт POST /api/v1/masters/:master_id/schedule/exceptions добавляет исключение из расписания. Доступен аналогично обновлению расписания. Принимает JSON с обязательными exception_date в будущем, exception_type из day_off, custom_hours, fully_booked и условно обязательными custom_start_time, custom_end_time если тип custom_hours, опциональным reason. Валидация проверяет отсутствие дублирующего исключения на ту же дату для того же мастера. Возвращается 201 с созданным исключением.Эндпоинт DELETE /api/v1/masters/:master_id/schedule/exceptions/:exception_id удаляет исключение. Доступен аналогично созданию. Возвращается 204.Эндпоинт GET /api/v1/masters/:master_id/available-slots вычисляет доступные слоты для записи. Публично доступен для реализации онлайн-записи. Принимает обязательные параметры запроса date дату для которой нужны слоты, service_id для определения длительности, branch_id для определения филиала и опциональный duration_override для переопределения длительности услуги если клиент выбрал несколько услуг. Система выполняет сложный алгоритм расчета: получает базовое расписание мастера для дня недели даты, проверяет исключения на данную дату, получает все существующие записи мастера на эту дату, разбивает рабочее время на слоты с шагом 15 минут начиная с start_time, для каждого слота проверяет что целиком помещается услуга заданной длительности, слот не пересекается с существующими записями с учетом буфера 5 минут между записями, слот не попадает в перерывы, слот находится в будущем относительно текущего времени с буфером минимум 1 час для онлайн-записей. Возвращает массив объектов с полями slot_time время начала слота, slot_end время окончания, is_available всегда true в результатах. Возвращается 200 с массивом доступных слотов. Если слотов нет возвращается пустой массив.Группа эндпоинтов управления записями. Эндпоинт POST /api/v1/bookings создает новую запись. Доступен клиентам для самостоятельной записи и сотрудникам салона для записи от имени клиента. Принимает JSON с обязательными master_id, service_id, branch_id, booking_date, start_time и опциональными client_phone для записи менеджером если клиент не зарегистрирован в системе, client_id если известен, notes_from_client, created_via автоматически определяется из источника запроса. Валидация выполняет проверку что мастер активен и привязан к указанному филиалу, услуга активна и доступна у мастера, выбранный слот действительно свободен путем повторного вызова логики available-slots, дата записи в будущем с учетом минимального буфера. Система создает запись со статусом pending, вычисляет end_time как start_time плюс service.duration_minutes, фиксирует final_price из текущей стоимости услуги у мастера, ставит в очередь задачу отправки подтверждения клиенту через WhatsApp и уведомления мастеру. Возвращается 201 с полным объектом записи включая id, booking_number уникальный номер для отображения клиенту, client объект, master объект с именем, service объект с названием, branch объект с адресом, booking_date, start_time, end_time, final_price, status, notes. При конфликте времени 409 с slot_no_longer_available.Эндпоинт GET /api/v1/bookings/:booking_id возвращает детальную информацию о записи. Доступен клиенту-владельцу записи и сотрудникам салона. Возвращает полный объект записи аналогично созданию с дополнительными полями created_at, updated_at, reminded указывающим была ли отправлена напоминалка, can_cancel флагом возможности отмены, can_reschedule флагом возможности переноса. Возвращается 200 с объектом записи. При отсутствии доступа 403.Эндпоинт GET /api/v1/bookings возвращает список записей. Для клиентов возвращает их собственные записи. Для сотрудников салона записи их салона. Для мастеров записи где они исполнители. Поддерживает параметры запроса status для фильтрации по статусу, date_from и date_to для временного диапазона, branch_id для филиала, master_id для мастера, client_id для клиента, page и per_page для пагинации с дефолтными значениями 1 и 20 соответственно. Возвращает объект с полями items массивом записей, total общим количеством, page текущей страницей, per_page размером страницы, total_pages общим количеством страниц. Возвращается 200 с объектом пагинации.Эндпоинт PATCH /api/v1/bookings/:booking_id обновляет запись. Доступен клиенту-владельцу для ограниченных изменений и сотрудникам салона для полного управления. Принимает JSON с опциональными status для смены статуса из определенных переходов, start_time для переноса с валидацией доступности нового слота, notes_for_master для добавления комментариев менеджером. Валидация переходов статусов разрешает клиенту только cancelled_by_client из pending или confirmed, мастеру in_progress из confirmed, completed из in_progress, no_show из confirmed если запись в прошлом. При переносе времени пересчитывается end_time и проверяется доступность. Обновление статуса в completed ставит в очередь отправку запроса на отзыв клиенту. Возвращается 200 с обновленным объектом записи. При недопустимом переходе статуса 400 с invalid_status_transition.Эндпоинт DELETE /api/v1/bookings/:booking_id отменяет запись. Доступен клиенту-владельцу и сотрудникам салона. Фактически обновляет статус в cancelled_by_client если отменяет клиент или cancelled_by_salon если отменяет салон, устанавливает cancelled_at и принимает JSON с опциональным cancellation_reason. Ставит в очередь отправку уведомления об отмене. Возвращается 204.Группа эндпоинтов управления отзывами. Эндпоинт POST /api/v1/reviews создает новый отзыв. Доступен только авторизованным клиентам. Принимает JSON с обязательными salon_id, rating от 1 до 5, booking_id для привязки к конкретному визиту и опциональными master_id если отзыв на мастера, review_text, review_photos массивом URL загруженных через отдельный эндпоинт изображений. Валидация проверяет что указанная запись существует, принадлежит текущему клиенту, имеет статус completed, на нее еще не был оставлен отзыв. Система создает отзыв со статусом is_verified true автоматически, is_visible true для немедленной публикации, обновляет рейтинг мастера и салона пересчитывая средние значения. Возвращается 201 с созданным отзывом.Эндпоинт GET /api/v1/reviews возвращает список отзывов. Публично доступен с обязательным параметром salon_id или master_id для получения отзывов салона или мастера. Поддерживает параметры rating для фильтрации по оценке, sort по значениям recent, highest_rated, lowest_rated для сортировки, page и per_page для пагинации. Возвращает объект пагинации с массивом отзывов содержащих id, client с анонимизированными данными first_name и первая буква last_name для защиты приватности, rating, review_text, review_photos, created_at, salon_response объектом если был ответ с response_text и responded_at, master объектом если отзыв на мастера. Возвращается 200 с пагинированным списком.Эндпоинт POST /api/v1/reviews/:review_id/response добавляет ответ салона на отзыв. Доступен владельцу и менеджерам салона которому оставлен отзыв. Принимает JSON с обязательным response_text. Валидация проверяет что отзыв относится к салону пользователя, ответ еще не был оставлен. Обновляет поля salon_response и responded_at. Ставит в очередь отправку уведомления клиенту о получении ответа. Возвращается 200 с обновленным объектом отзыва.Эндпоинт DELETE /api/v1/reviews/:review_id скрывает отзыв. Доступен только администратору платформы для модерации. Устанавливает is_visible в false. Отзыв перестает отображаться публично но остается в базе. Возвращается 204.Группа эндпоинтов публичного каталога. Эндпоинт GET /api/v1/catalog/salons возвращает список салонов в каталоге. Публично доступен. Поддерживает параметры запроса category_id для фильтрации по категории обязательно, city для фильтрации по городу, search для полнотекстового поиска по названию и описанию салона, sort по значениям relevance, rating, recent для алгоритма ранжирования, page и per_page. Система реализует сложную логику ранжирования: салоны с активным участием в аукционе и ненулевой ставкой auction_bid сортируются в начало списка внутри своей категории согласно размеру ставки, органические салоны сортируются по алгоритму комбинирующему рейтинг, количество отзывов, давность последней активности. Платные и органические позиции чередуются в соотношении примерно 1 к 3. При каждом показе салона создается запись в catalog_impressions с агрегацией по часам. Возвращается объект пагинации с массивом салонов содержащих id, display_name, slug для формирования ссылки, category объект, description по языку пользователя, logo_url, cover_image_url, rating, total_reviews, city, address строкой главного филиала, is_promoted флагом. Возвращается 200 с пагинированным списком.Эндпоинт POST /api/v1/catalog/salons/:salon_id/click регистрирует клик по салону в каталоге. Публично доступен. Принимает JSON с опциональным session_id для группировки кликов. Система создает запись в catalog_clicks, если салон был показан как платный с is_promoted true вычисляет стоимость клика как auction_bid умножить на коэффициент например 0.5, списывает сумму из advertising_budget салона, при достижении нулевого баланса автоматически отключает участие в аукционе. Возвращается 204 без тела.Эндпоинт GET /api/v1/catalog/salons/:salon_slug публичная страница салона. Публично доступен принимая slug салона. Возвращает полную публичную информацию о салоне включая все филиалы с адресами и графиками работы, все активные услуги с ценами, всех активных мастеров с портфолио и рейтингами, последние отзывы с пагинацией, ссылку на автоматически сгенерированный сайт salon_website_url как https://slug.jazyl.tech. Возвращается 200 с полным объектом салона. При несуществующем slug 404.Группа эндпоинтов управления рекламным бюджетом и аукционом. Эндпоинт POST /api/v1/salons/:salon_id/advertising/topup пополняет рекламный бюджет. Доступен владельцу салона. Принимает JSON с обязательным amount суммой пополнения больше минимального порога например 5000 тенге, payment_method способом оплаты. Система создает запись платежа со статусом pending, возвращает payment_url для перенаправления на платежный шлюз с параметрами транзакции. После успешной оплаты через webhook обновляется статус платежа на completed, увеличивается advertising_budget салона на соответствующую сумму. Возвращается 201 с объектом платежа и payment_url.Эндпоинт PATCH /api/v1/salons/:salon_id/advertising/bid обновляет ставку аукциона. Доступен владельцу салона. Принимает JSON с обязательным bid_amount ставкой за клик больше минимальной ставки категории например 50 тенге. Валидация проверяет что advertising_budget достаточен для участия в аукционе с минимальным порогом например 1000 тенге. Обновляет auction_bid салона. При установке ставки в 0 отключает участие в аукционе. Возвращается 200 с обновленной информацией о рекламной кампании.Эндпоинт GET /api/v1/salons/:salon_id/advertising/stats возвращает статистику рекламной кампании. Доступен владельцу салона. Поддерживает параметры date_from и date_to для временного диапазона по умолчанию текущий месяц. Возвращает объект с полями current_budget текущим балансом, total_spent потраченной суммой за период, total_impressions количеством показов, total_clicks количеством кликов, ctr показателем кликабельности, average_position средней позицией в выдаче, estimated_daily_spend оценкой дневных трат при текущей ставке, days_remaining расчетным количеством дней до исчерпания бюджета. Возвращается 200 с объектом статистики.Группа эндпоинтов кастомизации сайтов салонов. Эндпоинт GET /api/v1/salons/:salon_id/site возвращает текущие настройки сайта. Доступен владельцу салона. Возвращает объект из таблицы site_customizations с полным описанием настроек шаблона цветов шрифтов секций и SEO. При отсутствии настроек возвращает дефолтную конфигурацию. Возвращается 200 с объектом настроек.Эндпоинт PUT /api/v1/salons/:salon_id/site обновляет настройки сайта. Доступен владельцу салона. Принимает JSON с опциональными полями template_name, color_scheme объектом с primary_color, secondary_color, accent_color в формате HEX, fonts объектом с heading_font и body_font из предустановленного списка, hero_section объектом настроек главной секции, sections массивом объектов настроек секций, custom_text мультиязычным полем, seo_settings объектом с метатегами по языкам. Валидация проверяет валидность цветовых кодов, доступность выбранных шрифтов, корректность структуры sections. Система обновляет или создает запись в site_customizations, инвалидирует кеш сгенерированного сайта для его пересборки. Возвращается 200 с обновленными настройками.Эндпоинт POST /api/v1/salons/:salon_id/site/publish публикует изменения сайта. Доступен владельцу салона. Триггерит процесс регенерации сайта салона на основе текущих настроек и данных. Система генерирует статический HTML/CSS/JS сайта из шаблона с подстановкой данных салона, загружает на CDN или в директорию веб-сервера, обновляет DNS записи если необходимо для нового поддомена. Процесс выполняется асинхронно через Celery. Возвращается 202 с сообщением о принятии запроса и estimated_completion_time около 2 минут.Группа административных эндпоинтов платформы доступна только пользователям с ролью platform_admin. Эндпоинт GET /api/v1/admin/salons возвращает список всех салонов платформы. Поддерживает параметры category_id, is_active, is_visible_in_catalog, subscription_status для фильтрации, search для поиска по названию владельцу email, page и per_page. Возвращает расширенный объект салонов включая owner объект с email и контактами, subscription с детальными датами и статусом платежей, statistics с метриками использования платформы. Возвращается 200 с пагинированным списком.Эндпоинт PATCH /api/v1/admin/salons/:salon_id управляет салоном. Принимает JSON с опциональными is_active для активации деактивации салона, is_visible_in_catalog для управления участием в каталоге, subscription_plan_id для смены тарифа, subscription_end_date для продления подписки, notes для внутренних заметок администратора. Изменения логируются в audit_logs. Возвращается 200 с обновленным салоном.Эндпоинт GET /api/v1/admin/statistics возвращает агрегированную статистику платформы. Поддерживает параметры date_from и date_to для периода. Возвращает объект с метриками total_salons общим количеством салонов, active_salons количеством активных, salons_by_category распределением по категориям, total_masters, total_clients, total_bookings общим количеством записей, bookings_this_month записями за текущий месяц, completed_bookings_rate показателем завершенности, total_reviews, average_platform_rating средним рейтингом по платформе, revenue объектом с subscription_revenue, advertising_revenue, total_revenue, growth_rate относительно предыдущего периода. Возвращается 200 с объектом статистики.Эндпоинт GET /api/v1/admin/reviews/moderation возвращает отзывы требующие модерации. Система помечает отзывы для модерации на основе автоматических фильтров обнаруживающих подозрительный контент. Возвращает массив отзывов с флагом moderation_reason. Администратор может скрывать отзывы через DELETE эндпоинт. Возвращается 200 с массивом отзывов.РАЗДЕЛ 4: ДЕТАЛИЗАЦИЯ БИЗНЕС-ЛОГИКИ И АЛГОРИТМОВМеханизм онлайн-записи является критически важным компонентом платформы и требует безупречной работы для обеспечения положительного пользовательского опыта. Система поддерживает три различных сценария записи оптимизированных для разных паттернов поведения клиентов.Первый сценарий записи через мастера ориентирован на клиентов имеющих предпочтение к конкретному специалисту. Клиент начинает с просмотра списка мастеров салона с их фотографиями рейтингами специализациями и портфолио работ. После выбора мастера система отображает календарь с доступными датами выделением занятых и свободных дней. При выборе даты клиенту показываются все доступные временные слоты в этот день вычисленные с учетом расписания мастера его существующих записей и исключений. После выбора времени система показывает список услуг которые оказывает данный мастер с ценами и длительностью. Клиент выбирает услугу видит итоговую стоимость и время окончания визита и подтверждает запись.Второй сценарий записи через услугу подходит клиентам ориентированным на конкретную процедуру. Клиент просматривает каталог услуг салона организованный по категориям с описаниями и ценами. После выбора интересующей услуги система показывает всех мастеров оказывающих эту услугу отсортированных по релевантности учитывающей рейтинг специализацию и ближайшую доступность. Для каждого мастера отображается его ближайший доступный слот что позволяет клиенту одним действием выбрать связку мастер и время. Система показывает подтверждение с детальной информацией о записи.Третий сценарий записи через время и дату оптимизирован для клиентов с жесткими временными рамками. Клиент открывает календарь и выбирает удобную дату и время из доступных слотов. Система показывает всех мастеров свободных в выбранное время с их специализациями и рейтингами. После выбора мастера клиент видит список услуг которые тот оказывает и выбирает нужную. Система подтверждает что выбранный слот вмещает услугу заданной длительности и создает запись.Алгоритм вычисления доступных слотов работает следующим образом. На входе получает дату мастера услугу для определения длительности и филиал. Система извлекает из базы базовое расписание мастера для дня недели соответствующего дате. Проверяет таблицу schedule_exceptions на наличие исключений для данной даты. Если найдено исключение типа day_off слоты не генерируются вовсе. Если тип custom_hours используются кастомные временные границы из исключения вместо базового расписания. Если тип fully_booked слоты не генерируются. При отсутствии исключений используется базовое расписание. Система получает все существующие записи мастера на данную дату со статусами pending, confirmed, in_progress. Рабочее время разбивается на слоты с шагом 15 минут начиная с start_time рабочего дня. Для каждого потенциального слота проверяется возможность полностью разместить услугу с ее длительностью duration_minutes. Слот проверяется на пересечение с существующими записями учитывая буферное время 5 минут после каждой записи для подготовки мастера. Слот проверяется на попадание в перерывы из массива breaks расписания. Если дата слота соответствует текущему дню проверяется что время слота находится минимум на 60 минут в будущем от текущего времени сервера. Все валидные слоты добавляются в результирующий массив и возвращаются клиенту отсортированными по времени начала.Система управления расписанием позволяет гибко настраивать рабочее время мастеров. Базовое расписание определяется на уровне комбинации мастер и филиал что позволяет одному мастеру иметь разные графики работы в разных локациях салона. Расписание хранится отдельной записью для каждого дня недели с флагом is_working определяющим рабочий ли это день. Для рабочих дней указываются start_time и end_time рабочего дня а также массив перерывов breaks с временными интервалами и опциональными причинами например обеденный перерыв техническая пауза. Система не позволяет создавать перекрывающиеся перерывы или перерывы выходящие за границы рабочего дня что обеспечивается валидацией на уровне API.Исключения из расписания используются для временных изменений графика без редактирования базового расписания. Мастер или менеджер может создать исключение типа day_off для объявления выходного дня например по личным обстоятельствам или болезни. Исключение типа custom_hours позволяет изменить время начала и окончания работы для конкретной даты например выход на работу на несколько часов в обычный выходной или сокращенный рабочий день. Исключение типа fully_booked используется когда мастер хочет закрыть слоты для онлайн-записи например если забронировано время для работы вне салона или участия в мероприятии. Исключения имеют приоритет над базовым расписанием и применяются автоматически при расчете доступных слотов. Исключения можно создавать заблаговременно что помогает в планировании отпусков и командировок.Система статусов записей управляет жизненным циклом бронирования. При создании записи клиентом через онлайн-запись устанавливается статус pending означающий что запись создана но еще не подтверждена. При создании записи менеджером салона статус сразу устанавливается в confirmed так как считается что менеджер проверил доступность и согласовал время с клиентом. Переход из pending в confirmed может происходить автоматически по прошествии 10 минут после создания записи если за это время не поступил запрос на отмену или вручную менеджером салона. Статус in_progress устанавливается мастером в момент начала оказания услуги и указывает что клиент находится в салоне. Переход из in_progress в completed выполняется мастером после завершения услуги и является триггером для отправки клиенту запроса на оставление отзыва. Статус cancelled_by_client устанавливается когда клиент самостоятельно отменяет запись через приложение или сайт. Статус cancelled_by_salon устанавливается когда отмену инициирует салон например в случае болезни мастера или форс-мажора. Статус no_show используется мастером для отметки ситуации когда клиент не пришел на запись без предупреждения. Все изменения статусов логируются с временными метками и триггерят соответствующие уведомления.Механизм отмены и переноса записей регулируется бизнес-правилами для защиты интересов обеих сторон. Клиенты могут отменять записи бесплатно если до назначенного времени остается более 24 часов. При отмене менее чем за 24 часа но более чем за 2 часа система может накладывать штрафные санкции в виде начисления процента от стоимости услуги на внутренний счет клиента для будущих записей если салон включил данную опцию в настройках. Отмена менее чем за 2 часа возможна только через контакт с салоном напрямую. Салон может отменять записи в любое время но система автоматически отправляет клиенту уведомление и предлагает выбрать альтернативное время. Перенос записи клиентом доступен один раз бесплатно при изменении более чем за 24 часа. Последующие переносы или переносы в последний момент рассматриваются как отмена с созданием новой записи. Система хранит историю всех изменений записи включая первоначальное и все последующие времена причины отмен и переносов для разрешения возможных споров.Система отзывов построена на принципе обеспечения доверия и аутентичности. Оставить отзыв может только клиент который фактически посетил салон что подтверждается наличием записи со статусом completed. Отзыв привязывается к конкретной записи через поле booking_id и система обеспечивает уникальность комбинации booking_id и client_id предотвращая дублирование отзывов на один визит. После завершения услуги когда мастер переводит запись в статус completed система автоматически через 2 часа отправляет клиенту сообщение в WhatsApp с персонализированной ссылкой на форму оставления отзыва. Ссылка содержит подписанный токен с зашифрованными booking_id и client_id имеющий срок действия 30 дней. Клиент может оставить отзыв по этой ссылке без необходимости дополнительной аутентификации так как токен уже верифицирован. Альтернативно авторизованный клиент может оставить отзыв через каталог или приложение где система автоматически найдет его завершенные визиты в выбранный салон и предложит оставить отзыв если он еще не был оставлен.Структура отзыва включает обязательный числовой рейтинг от 1 до 5 звезд, опциональный текстовый комментарий с ограничением 1000 символов и опциональные фотографии максимум 5 изображений демонстрирующих результат услуги. Отзыв может быть оставлен на салон в целом или на конкретного мастера через указание master_id. При указании мастера отзыв учитывается как в общем рейтинге салона так и в персональном рейтинге мастера. Система автоматически вычисляет средние рейтинги путем агрегации всех отзывов с использованием триггеров базы данных обновляющих поля rating и total_reviews в таблицах salons и masters при добавлении нового отзыва. Это обеспечивает производительность запросов отображения списков салонов и мастеров без необходимости вычислять рейтинги на лету.Модерация отзывов осуществляется комбинацией автоматических фильтров и ручной проверки администраторами платформы. Автоматические фильтры анализируют текст отзыва на наличие обсценной лексики, спам-паттернов, попыток размещения рекламы конкурентов, ссылок на внешние ресурсы. При срабатывании фильтра отзыв автоматически получает флаг требующий модерации и не отображается публично до проверки. Администратор платформы может просмотреть список отзывов ожидающих модерации принять решение об одобрении с установкой is_visible в true или отклонении с установкой is_visible в false и отправкой уведомления автору. Салоны могут отвечать на отзывы через функционал salon_response что помогает в управлении репутацией. Ответ салона отображается под отзывом и также может содержать текст до 500 символов. Удаление отзывов невозможно ни клиентами ни салонами обеспечивая честность системы. Только администратор платформы может скрыть отзыв в исключительных случаях нарушения правил платформы.Каталог салонов является центральной точкой привлечения клиентов на платформу и его алгоритм ранжирования критически важен для баланса интересов салонов и пользователей. Каталог организован по категориям и пользователь обязательно выбирает категорию услуг которые ищет. Внутри категории работает аукционная система продвижения где салоны могут устанавливать ставку за клик для участия в борьбе за топ-позиции. Алгоритм ранжирования разделяет салоны на две группы: платные участники аукциона с активной ставкой auction_bid больше нуля и положительным балансом advertising_budget, органические салоны не участвующие в аукционе или с нулевым бюджетом.Платные позиции сортируются внутри своей группы по размеру ставки auction_bid в порядке убывания. Салон с наивысшей ставкой получает первую платную позицию при условии что его баланса достаточно для покрытия кликов. Система прогнозирует исчерпание бюджета и может временно снижать позицию салона если его баланс критически низок для сохранения участия на более длительный период вместо быстрого исчерпания. Органические позиции ранжируются по составному алгоритму учитывающему рейтинг салона со взвешенным коэффициентом 0.4, количество отзывов с коэффициентом 0.3, давность последней активности такой как новые отзывы или записи с коэффициентом 0.2, и полноту профиля наличие логотипа обложки описания с коэффициентом 0.1. Финальная сортировка чередует платные и органические позиции в соотношении примерно 1 платная на 3 органические то есть позиции 1 платная 2-4 органические 5 платная 6-8 органические и так далее.При каждом отображении салона в результатах поиска каталога система регистрирует показ impression в таблице catalog_impressions с агрегацией по часам для оптимизации хранения. При клике пользователя на салон система регистрирует клик в таблице catalog_clicks. Если салон занимал платную позицию с флагом is_promoted true система вычисляет стоимость клика которая равна auction_bid салона умноженной на коэффициент эффективности обычно 0.5 то есть фактическая стоимость клика составляет половину ставки. Вычисленная стоимость списывается с advertising_budget салона. Система проверяет баланс после каждого списания и при достижении порогового значения например 100 тенге отправляет владельцу салона уведомление о необходимости пополнения. При достижении нулевого баланса салон автоматически исключается из аукциона до пополнения бюджета но продолжает отображаться в органической выдаче. Все транзакции списания логируются в таблице payments с типом advertising_spend для возможности формирования детальных отчетов.Система тарифных планов определяет доступные возможности для салонов и является источником монетизации платформы. При регистрации нового салона автоматически активируется пробный тариф trial длительностью 14 дней предоставляющий полный доступ ко всем функциям платформы без ограничений для знакомства с сервисом. По истечении пробного периода салон должен выбрать один из платных тарифов для продолжения работы. Тарифный план basic является начальным платным планом стоимостью 15000 тенге в месяц и включает возможность добавления до 5 мастеров, до 3 филиалов, неограниченное количество услуг, неограниченное количество записей, базовую аналитику
